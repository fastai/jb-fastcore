
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Type dispatch &#8212; fastcore docs</title>
    
  <link rel="stylesheet" href="_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://fastai.github.io/jb-fastcore/04_dispatch.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />


<!-- Opengraph tags -->
<meta property="og:url"         content="https://fastai.github.io/jb-fastcore/04_dispatch.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Type dispatch" />
<meta property="og:description" content="Type dispatch  Basic single and dual parameter dispatch  Helpers  #export def lenient_issubclass(cls, types):     &#34;If possible return whether `cls` is a subclas" />
<meta property="og:image"       content="https://fastai.github.io/jb-fastcore/_static/logo.png" />

<meta name="twitter:card" content="summary" />


  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  <img src="_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">fastcore docs</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="index.html">
   Welcome to fastcore
  </a>
 </li>
</ul>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="00_test.html">
   Test
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_basics.html">
   Basic functionality
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_basics.html#export">
   Export -
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/04_dispatch.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/fastai/jb-fastcore/master?urlpath=tree/docs/04_dispatch.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#helpers">
   Helpers
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#typedispatch">
   TypeDispatch
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-bases">
     Using
     <code class="docutils literal notranslate">
      <span class="pre">
       bases
      </span>
     </code>
     :
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#up-to-two-arguments">
     Up To Two Arguments
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#matching">
     Matching
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-typedispatch-with-methods">
     Using TypeDispatch With Methods
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-typedispatch-with-class-methods">
     Using TypeDispatch With Class Methods
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#typedispatch-decorator">
   typedispatch Decorator
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-typedispatch-with-other-decorators">
     Using typedispatch With other decorators
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#casting">
   Casting
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#export">
   Export -
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#default_exp dispatch</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="kn">from</span> <span class="nn">fastcore.imports</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">fastcore.foundation</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">fastcore.utils</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nbdev.showdoc</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">fastcore.test</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">fastcore.nb_imports</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="type-dispatch">
<h1>Type dispatch<a class="headerlink" href="#type-dispatch" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><p>Basic single and dual parameter dispatch</p>
</div></blockquote>
<div class="section" id="helpers">
<h2>Helpers<a class="headerlink" href="#helpers" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">lenient_issubclass</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">types</span><span class="p">):</span>
    <span class="s2">&quot;If possible return whether `cls` is a subclass of `types`, otherwise return False.&quot;</span>
    <span class="k">if</span> <span class="bp">cls</span> <span class="ow">is</span> <span class="nb">object</span> <span class="ow">and</span> <span class="n">types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">object</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span> <span class="c1"># treat `object` as highest level</span>
    <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">types</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">types</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="ow">not</span> <span class="n">lenient_issubclass</span><span class="p">(</span><span class="n">typing</span><span class="o">.</span><span class="n">Collection</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">lenient_issubclass</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Collection</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">lenient_issubclass</span><span class="p">(</span><span class="n">typing</span><span class="o">.</span><span class="n">Collection</span><span class="p">,</span> <span class="nb">object</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">lenient_issubclass</span><span class="p">(</span><span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Collection</span><span class="p">)</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">lenient_issubclass</span><span class="p">(</span><span class="n">typing</span><span class="o">.</span><span class="n">Collection</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">)</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">lenient_issubclass</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">sorted_topologically</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">cmp</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">lt</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="s2">&quot;Return a new list containing all items from the iterable sorted topologically&quot;</span>
    <span class="n">l</span><span class="p">,</span><span class="n">res</span> <span class="o">=</span> <span class="n">L</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">iterable</span><span class="p">)),[]</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="n">y</span> <span class="k">if</span> <span class="n">cmp</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">l</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">reverse</span> <span class="k">else</span> <span class="n">res</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">td</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">sorted_topologically</span><span class="p">(</span><span class="n">td</span><span class="p">),</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">sorted_topologically</span><span class="p">(</span><span class="n">td</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">td</span> <span class="o">=</span> <span class="p">{</span><span class="nb">int</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Integral</span><span class="p">:</span><span class="mi">3</span><span class="p">}</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">sorted_topologically</span><span class="p">(</span><span class="n">td</span><span class="p">,</span> <span class="n">cmp</span><span class="o">=</span><span class="n">lenient_issubclass</span><span class="p">),</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Integral</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">td</span> <span class="o">=</span> <span class="p">[</span><span class="n">numbers</span><span class="o">.</span><span class="n">Integral</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span>
<span class="n">td</span> <span class="o">=</span> <span class="n">sorted_topologically</span><span class="p">(</span><span class="n">td</span><span class="p">,</span> <span class="n">cmp</span><span class="o">=</span><span class="n">lenient_issubclass</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">td</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">td</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">numbers</span><span class="o">.</span><span class="n">Integral</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">_chk_defaults</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">ann</span><span class="p">):</span>
    <span class="k">pass</span>
<span class="c1"># Implementation removed until we can figure out how to do this without `inspect` module</span>
<span class="c1">#     try: # Some callables don&#39;t have signatures, so ignore those errors</span>
<span class="c1">#         params = list(inspect.signature(f).parameters.values())[:min(len(ann),2)]</span>
<span class="c1">#         if any(p.default!=inspect.Parameter.empty for p in params):</span>
<span class="c1">#             warn(f&quot;{f.__name__} has default params. These will be ignored.&quot;)</span>
<span class="c1">#     except ValueError: pass</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">_p2_anno</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="s2">&quot;Get the 1st 2 annotations of `f`, defaulting to `object`&quot;</span>
    <span class="n">hints</span> <span class="o">=</span> <span class="n">type_hints</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">ann</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">o</span> <span class="ow">in</span> <span class="n">hints</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">n</span><span class="o">!=</span><span class="s1">&#39;return&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">f</span><span class="p">):</span> <span class="n">_chk_defaults</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">ann</span><span class="p">)</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">ann</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span> <span class="n">ann</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ann</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#hide</span>
<span class="k">def</span> <span class="nf">_f</span><span class="p">(</span><span class="n">a</span><span class="p">):</span> <span class="k">pass</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">_p2_anno</span><span class="p">(</span><span class="n">_f</span><span class="p">),</span> <span class="p">(</span><span class="nb">object</span><span class="p">,</span><span class="nb">object</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">_f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span> <span class="k">pass</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">_p2_anno</span><span class="p">(</span><span class="n">_f</span><span class="p">),</span> <span class="p">(</span><span class="nb">object</span><span class="p">,</span><span class="nb">object</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">_f</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">str</span><span class="p">:</span> <span class="k">pass</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">_p2_anno</span><span class="p">(</span><span class="n">_f</span><span class="p">),</span> <span class="p">(</span><span class="n">NoneType</span><span class="p">,</span><span class="nb">object</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">_f</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">float</span><span class="p">:</span> <span class="k">pass</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">_p2_anno</span><span class="p">(</span><span class="n">_f</span><span class="p">),</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="nb">object</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">_f</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">float</span><span class="p">:</span> <span class="k">pass</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">_p2_anno</span><span class="p">(</span><span class="n">_f</span><span class="p">),</span> <span class="p">(</span><span class="n">NoneType</span><span class="p">,</span><span class="nb">str</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">_f</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">float</span><span class="p">:</span> <span class="k">pass</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">_p2_anno</span><span class="p">(</span><span class="n">_f</span><span class="p">),</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">_f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span><span class="nb">int</span><span class="p">):</span> <span class="k">pass</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">_p2_anno</span><span class="p">(</span><span class="n">_f</span><span class="p">),</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">_f</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">float</span><span class="p">:</span> <span class="k">pass</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">_p2_anno</span><span class="p">(</span><span class="n">_f</span><span class="p">),</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">str</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">_p2_anno</span><span class="p">(</span><span class="n">attrgetter</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)),</span> <span class="p">(</span><span class="nb">object</span><span class="p">,</span><span class="nb">object</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#hide</span>
<span class="c1"># Disabled until _chk_defaults fixed</span>
<span class="c1"># def _f(x:int,y:int=10): pass</span>
<span class="c1"># test_warns(lambda: _p2_anno(_f))</span>
<span class="k">def</span> <span class="nf">_f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span> <span class="k">pass</span>
<span class="n">_p2_anno</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="n">_p2_anno</span><span class="p">(</span><span class="n">_f</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>([object, object], [int, object])
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="typedispatch">
<h2>TypeDispatch<a class="headerlink" href="#typedispatch" title="Permalink to this headline">¶</a></h2>
<p>Type dispatch, or <a class="reference external" href="https://en.wikipedia.org/wiki/Multiple_dispatch#Julia">Multiple dispatch</a>, allows you to change the way a function behaves based upon the input types it recevies.  This is a prominent feature in some  programming languages like Julia.  For example, this is a <a class="reference external" href="https://en.wikipedia.org/wiki/Multiple_dispatch#Julia">conceptual example</a> of how multiple dispatch works in Julia, returning different values depending on the input types of x and y:</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">collide_with</span><span class="p">(</span><span class="n">x</span><span class="o">::</span><span class="n">Asteroid</span><span class="p">,</span> <span class="n">y</span><span class="o">::</span><span class="n">Asteroid</span><span class="p">)</span> <span class="o">=</span> <span class="o">...</span> 
<span class="c"># deal with asteroid hitting asteroid</span>

<span class="n">collide_with</span><span class="p">(</span><span class="n">x</span><span class="o">::</span><span class="n">Asteroid</span><span class="p">,</span> <span class="n">y</span><span class="o">::</span><span class="n">Spaceship</span><span class="p">)</span> <span class="o">=</span> <span class="o">...</span> 
<span class="c"># deal with asteroid hitting spaceship</span>

<span class="n">collide_with</span><span class="p">(</span><span class="n">x</span><span class="o">::</span><span class="n">Spaceship</span><span class="p">,</span> <span class="n">y</span><span class="o">::</span><span class="n">Asteroid</span><span class="p">)</span> <span class="o">=</span> <span class="o">...</span> 
<span class="c"># deal with spaceship hitting asteroid</span>

<span class="n">collide_with</span><span class="p">(</span><span class="n">x</span><span class="o">::</span><span class="n">Spaceship</span><span class="p">,</span> <span class="n">y</span><span class="o">::</span><span class="n">Spaceship</span><span class="p">)</span> <span class="o">=</span> <span class="o">...</span> 
<span class="c"># deal with spaceship hitting spaceship</span>
</pre></div>
</div>
<p>Type dispatch can be especially useful in data science, where you might allow different input types (i.e. numpy arrays and pandas dataframes) to function that processes data. Type dispatch allows you to have a common API for functions that do similar tasks.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">TypeDispatch</span></code> class allows us to achieve type dispatch in Python. It contains a dictionary that maps types from type annotations to functions,  which ensures that the proper function is called when passed inputs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">class</span> <span class="nc">_TypeDict</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="p">{},{}</span>

    <span class="k">def</span> <span class="nf">_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">sorted_topologically</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="n">cmp</span><span class="o">=</span><span class="n">lenient_issubclass</span><span class="p">)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="s2">&quot;Add type `t` and function `f`&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="nb">tuple</span><span class="p">):</span> <span class="n">t</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">L</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">t_</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">t_</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reset</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">all_matches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="s2">&quot;Find first matching type that is a super-class of `k`&quot;</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">:</span>
            <span class="n">types</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="k">if</span> <span class="n">lenient_issubclass</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">f</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">o</span><span class="p">]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">types</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="s2">&quot;Find first matching type that is a super-class of `k`&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_matches</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">first</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="n">first</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">class</span> <span class="nc">TypeDispatch</span><span class="p">:</span>
    <span class="s2">&quot;Dictionary-like object; `__getitem__` matches keys of types using `issubclass`&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">funcs</span><span class="o">=</span><span class="p">(),</span> <span class="n">bases</span><span class="o">=</span><span class="p">()):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">funcs</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">bases</span> <span class="o">=</span> <span class="n">_TypeDict</span><span class="p">(),</span><span class="n">L</span><span class="p">(</span><span class="n">bases</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">is_not</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">L</span><span class="p">(</span><span class="n">funcs</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inst</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="s2">&quot;Add type `t` and function `f`&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">staticmethod</span><span class="p">):</span> <span class="n">a0</span><span class="p">,</span><span class="n">a1</span> <span class="o">=</span> <span class="n">_p2_anno</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="vm">__func__</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">a0</span><span class="p">,</span><span class="n">a1</span> <span class="o">=</span> <span class="n">_p2_anno</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">funcs</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">_TypeDict</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">funcs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a0</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">first</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Get first function in ordered dict of type:func.&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">funcs</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">returns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="s2">&quot;Get the return type of annotation of `x`.&quot;</span>
        <span class="k">return</span> <span class="n">anno_ret</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)])</span>

    <span class="k">def</span> <span class="nf">_attname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">k</span><span class="p">):</span> <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;__name__&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_attname</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="si">}</span><span class="s1">,</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_attname</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="si">}</span><span class="s1">) -&gt; </span><span class="si">{</span><span class="nb">getattr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
             <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">funcs</span><span class="o">.</span><span class="n">d</span> <span class="k">for</span> <span class="n">l</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">funcs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="p">[</span><span class="n">o</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bases</span><span class="p">]</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">L</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">type</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">ts</span><span class="p">)]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="p">:</span> <span class="k">return</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">staticmethod</span><span class="p">):</span> <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="vm">__func__</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">inst</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">f</span> <span class="o">=</span> <span class="n">MethodType</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inst</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">owner</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">f</span> <span class="o">=</span> <span class="n">MethodType</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">owner</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inst</span><span class="p">,</span> <span class="n">owner</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inst</span> <span class="o">=</span> <span class="n">inst</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">owner</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="s2">&quot;Find first matching type that is a super-class of `k`&quot;</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">L</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span> <span class="n">k</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">funcs</span><span class="o">.</span><span class="n">all_matches</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">r</span><span class="p">:</span>
            <span class="n">o</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">o</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="n">o</span>
        <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bases</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">base</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">res</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="n">res</span>
        <span class="k">return</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<p>To demonstrate how <code class="docutils literal notranslate"><span class="pre">TypeDispatch</span></code> works, we define a set of functions that accept a variety of input types, specified with different type annotations:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f2</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="nb">float</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span>              <span class="c1">#int and float for 2nd arg</span>
<span class="k">def</span> <span class="nf">f_nin</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="n">numbers</span><span class="o">.</span><span class="n">Integral</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">:</span>  <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span> <span class="c1">#integral numeric</span>
<span class="k">def</span> <span class="nf">f_ni2</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="nb">int</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span>                      <span class="c1">#integer</span>
<span class="k">def</span> <span class="nf">f_bll</span><span class="p">(</span><span class="n">x</span><span class="p">:(</span><span class="nb">bool</span><span class="p">,</span><span class="nb">list</span><span class="p">)):</span> <span class="k">return</span> <span class="n">x</span>              <span class="c1">#bool or list</span>
<span class="k">def</span> <span class="nf">f_num</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span>           <span class="c1">#Number (root of numerics)          </span>
</pre></div>
</div>
</div>
</div>
<p>We can optionally initialize <code class="docutils literal notranslate"><span class="pre">TypeDispatch</span></code> with a list of functions we want to search.  Printing an instance of <code class="docutils literal notranslate"><span class="pre">TypeDispatch</span></code> will display convenient mapping of types -&gt; functions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">TypeDispatch</span><span class="p">([</span><span class="n">f_nin</span><span class="p">,</span><span class="n">f_ni2</span><span class="p">,</span><span class="n">f_num</span><span class="p">,</span><span class="n">f_bll</span><span class="p">,</span><span class="kc">None</span><span class="p">])</span>
<span class="n">t</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(bool,object) -&gt; f_bll
(int,object) -&gt; f_ni2
(Integral,object) -&gt; f_nin
(Number,object) -&gt; f_num
(list,object) -&gt; f_bll
(object,object) -&gt; NoneType
</pre></div>
</div>
</div>
</div>
<p>Note that only the first two arguments are used for <code class="docutils literal notranslate"><span class="pre">TypeDispatch</span></code>.  If your function only contains one argument, the second parameter will be shown as <code class="docutils literal notranslate"><span class="pre">object</span></code>.  If you pass <code class="docutils literal notranslate"><span class="pre">None</span></code> into <code class="docutils literal notranslate"><span class="pre">TypeDispatch</span></code>, then this will be displayed as <code class="docutils literal notranslate"><span class="pre">(object,</span> <span class="pre">object)</span> <span class="pre">-&gt;</span> <span class="pre">NoneType</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">TypeDispatch</span></code> is a dictionary-like object, which means that you can retrieve a function by the associated type annotation.  For example, the statement:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="n">t</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
</pre></div>
</div>
<p>Will return <code class="docutils literal notranslate"><span class="pre">f_num</span></code> because that is the matching function that has a type annotation that is a super-class of of <code class="docutils literal notranslate"><span class="pre">float</span></code> - <code class="docutils literal notranslate"><span class="pre">numbers.Number</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="nb">issubclass</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">f_num</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The same is true for other types as well:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="n">f_nin</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span> <span class="n">f_bll</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="nb">list</span><span class="p">],</span> <span class="n">f_bll</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="n">f_nin</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>If you try to get a type that doesn’t match, <code class="docutils literal notranslate"><span class="pre">TypeDispatch</span></code> will return <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">show_doc</span><span class="p">(</span><span class="n">TypeDispatch</span><span class="o">.</span><span class="n">add</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<h4 id="TypeDispatch.add" class="doc_header"><code>TypeDispatch.add</code><a href="__main__.py#L10" class="source_link" style="float:right">[source]</a></h4>
<blockquote>
<div><p><code>TypeDispatch.add</code>(<strong><code class="docutils literal notranslate"><span class="pre">f</span></code></strong>)</p>
</div></blockquote>
<p>Add type <code class="docutils literal notranslate"><span class="pre">t</span></code> and function <code class="docutils literal notranslate"><span class="pre">f</span></code></p>
</div>
</div>
<p>This method allows you to add an additional function to an existing <code class="docutils literal notranslate"><span class="pre">TypeDispatch</span></code> instance :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f_col</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="n">typing</span><span class="o">.</span><span class="n">Collection</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span>
<span class="n">t</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">f_col</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">f_col</span><span class="p">)</span>
<span class="n">t</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(bool,object) -&gt; f_bll
(int,object) -&gt; f_ni2
(Integral,object) -&gt; f_nin
(Number,object) -&gt; f_num
(list,object) -&gt; f_bll
(typing.Collection,object) -&gt; f_col
(object,object) -&gt; NoneType
</pre></div>
</div>
</div>
</div>
<p>If you accidentally add the same function more than once things will still work as expected:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">f_ni2</span><span class="p">)</span> 
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">f_ni2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>However, if you add a function that has a type collision that raises an ambiguity, this will automatically resolve to the latest function added:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f_ni3</span><span class="p">(</span><span class="n">z</span><span class="p">:</span><span class="nb">int</span><span class="p">):</span> <span class="k">return</span> <span class="n">z</span> <span class="c1"># collides with f_ni2 with same type annotations</span>
<span class="n">t</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">f_ni3</span><span class="p">)</span> 
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">f_ni3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="using-bases">
<h3>Using <code class="docutils literal notranslate"><span class="pre">bases</span></code>:<a class="headerlink" href="#using-bases" title="Permalink to this headline">¶</a></h3>
<p>The argument <code class="docutils literal notranslate"><span class="pre">bases</span></code> can optionally accept a single instance of <code class="docutils literal notranslate"><span class="pre">TypeDispatch</span></code> or a collection (i.e. a tuple or list) of <code class="docutils literal notranslate"><span class="pre">TypeDispatch</span></code> objects.  This can provide functionality similar to multiple inheritance.</p>
<p>These are searched for matching functions if no match in your list of functions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f_str</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="s1">&#39;1&#39;</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">TypeDispatch</span><span class="p">([</span><span class="n">f_nin</span><span class="p">,</span><span class="n">f_ni2</span><span class="p">,</span><span class="n">f_num</span><span class="p">,</span><span class="n">f_bll</span><span class="p">,</span><span class="kc">None</span><span class="p">])</span>
<span class="n">t2</span> <span class="o">=</span> <span class="n">TypeDispatch</span><span class="p">(</span><span class="n">f_str</span><span class="p">,</span> <span class="n">bases</span><span class="o">=</span><span class="n">t</span><span class="p">)</span> <span class="c1"># you can optionally supply a list of TypeDispatch objects for `bases`.</span>
<span class="n">t2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(str,object) -&gt; f_str
(bool,object) -&gt; f_bll
(int,object) -&gt; f_ni2
(Integral,object) -&gt; f_nin
(Number,object) -&gt; f_num
(list,object) -&gt; f_bll
(object,object) -&gt; NoneType
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">t2</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">f_ni2</span><span class="p">)</span>       <span class="c1"># searches `t` b/c not found in `t2`</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t2</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="n">f_nin</span><span class="p">)</span>  <span class="c1"># searches `t` b/c not found in `t2`</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t2</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">f_num</span><span class="p">)</span>     <span class="c1"># searches `t` b/c not found in `t2`</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t2</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span> <span class="n">f_bll</span><span class="p">)</span>      <span class="c1"># searches `t` b/c not found in `t2`</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t2</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">f_str</span><span class="p">)</span>       <span class="c1"># found in `t`!</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t2</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">),</span> <span class="s1">&#39;a1&#39;</span><span class="p">)</span>        <span class="c1"># found in `t`!, and uses __call__</span>

<span class="n">o</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t2</span><span class="p">(</span><span class="n">o</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>             <span class="c1"># found in `t2` and uses __call__</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="up-to-two-arguments">
<h3>Up To Two Arguments<a class="headerlink" href="#up-to-two-arguments" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">TypeDispatch</span></code> supports up to two arguments when searching for the appropriate function.  The following functions <code class="docutils literal notranslate"><span class="pre">f1</span></code> and <code class="docutils literal notranslate"><span class="pre">f2</span></code> both have two parameters:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f1</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="n">numbers</span><span class="o">.</span><span class="n">Integral</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span>  <span class="c1">#Integral is a numeric type</span>
<span class="k">def</span> <span class="nf">f2</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="nb">float</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">TypeDispatch</span><span class="p">([</span><span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">])</span>
<span class="n">t</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(int,float) -&gt; f2
(Integral,object) -&gt; f1
</pre></div>
</div>
</div>
</div>
<p>You can lookup functions from a <code class="docutils literal notranslate"><span class="pre">TypeDispatch</span></code> instance with two parameters like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="n">f1</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">],</span> <span class="n">f2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Keep in mind that anything beyond the first two parameters are ignored, and any collisions will be resolved in favor of the most recent function added.  In the below example, <code class="docutils literal notranslate"><span class="pre">f1</span></code> is ignored in favor of <code class="docutils literal notranslate"><span class="pre">f2</span></code> because the first two parameters have identical type hints:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f1</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span><span class="nb">list</span><span class="p">):</span> <span class="k">return</span> <span class="n">a</span>
<span class="k">def</span> <span class="nf">f2</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span><span class="nb">int</span><span class="p">):</span> <span class="k">return</span> <span class="n">b</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">TypeDispatch</span><span class="p">([</span><span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">f2</span><span class="p">)</span>
<span class="n">t</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(str,int) -&gt; f2
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="matching">
<h3>Matching<a class="headerlink" href="#matching" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Type</span> <span class="pre">Dispatch</span></code> matches types with functions according to whether the supplied class is a subclass or the same class of the type annotation(s) of associated functions.</p>
<p>Let’s consider an example where we try to retrieve the function corresponding to types of <code class="docutils literal notranslate"><span class="pre">[np.int32,</span> <span class="pre">float]</span></code>.</p>
<p>In this scenario, <code class="docutils literal notranslate"><span class="pre">f2</span></code> will not be matched. This is because the first type annotation of <code class="docutils literal notranslate"><span class="pre">f2</span></code>, <code class="docutils literal notranslate"><span class="pre">int</span></code>, is not a superclass (or the same class) of <code class="docutils literal notranslate"><span class="pre">np.int32</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f1</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="n">numbers</span><span class="o">.</span><span class="n">Integral</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span>
<span class="k">def</span> <span class="nf">f2</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="nb">float</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">TypeDispatch</span><span class="p">([</span><span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">])</span>

<span class="k">assert</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Instead, <code class="docutils literal notranslate"><span class="pre">f1</span></code> is a valid match, as its first argument is annoted with the type <code class="docutils literal notranslate"><span class="pre">numbers.Integeral</span></code>, which <code class="docutils literal notranslate"><span class="pre">np.int32</span></code> is a subclass of:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Integral</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span><span class="nb">float</span><span class="p">],</span> <span class="n">f1</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
<p>In <code class="docutils literal notranslate"><span class="pre">f1</span></code> , the 2nd parameter <code class="docutils literal notranslate"><span class="pre">y</span></code> is not annotated, which means <code class="docutils literal notranslate"><span class="pre">TypeDispatch</span></code> will match anything where the first argument matches <code class="docutils literal notranslate"><span class="pre">int</span></code> that is not matched with anything else:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="nb">issubclass</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Integral</span><span class="p">)</span> <span class="c1"># int is a subclass of numbers.Integral</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">f1</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">],</span> <span class="n">f1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>If no match is possible, <code class="docutils literal notranslate"><span class="pre">None</span></code> is returned:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="nb">float</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">show_doc</span><span class="p">(</span><span class="n">TypeDispatch</span><span class="o">.</span><span class="fm">__call__</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<h4 id="TypeDispatch.__call__" class="doc_header"><code>TypeDispatch.__call__</code><a href="__main__.py#L35" class="source_link" style="float:right">[source]</a></h4>
<blockquote>
<div><p><code>TypeDispatch.<strong>call</strong></code>(<strong>*<code class="docutils literal notranslate"><span class="pre">args</span></code></strong>, <strong>**<code class="docutils literal notranslate"><span class="pre">kwargs</span></code></strong>)</p>
</div></blockquote>
<p>Call self as a function.</p>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">TypeDispatch</span></code> is also callable.  When you call an instance of <code class="docutils literal notranslate"><span class="pre">TypeDispatch</span></code>, it will execute the relevant function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f_arr</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">f_int</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">TypeDispatch</span><span class="p">([</span><span class="n">f_arr</span><span class="p">,</span> <span class="n">f_int</span><span class="p">])</span>

<span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">arr</span><span class="p">),</span> <span class="mi">15</span><span class="p">)</span> <span class="c1"># dispatches to f_arr</span>

<span class="n">o</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">o</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="c1"># dispatches to f_int</span>
<span class="k">assert</span> <span class="n">t</span><span class="o">.</span><span class="n">first</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> 
</pre></div>
</div>
</div>
</div>
<p>You can also call an instance of of <code class="docutils literal notranslate"><span class="pre">TypeDispatch</span></code> when there are two parameters:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f1</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="n">numbers</span><span class="o">.</span><span class="n">Integral</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span>
<span class="k">def</span> <span class="nf">f2</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="nb">float</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">TypeDispatch</span><span class="p">([</span><span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">])</span>

<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mf">2.0</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>When no match is found, a <code class="docutils literal notranslate"><span class="pre">TypeDispatch</span></code> instance becomes an identity function.  This default behavior is leveraged by fasatai for data transformations to provide a sensible default when a matching function cannot be found.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">),</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">show_doc</span><span class="p">(</span><span class="n">TypeDispatch</span><span class="o">.</span><span class="n">returns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<h4 id="TypeDispatch.returns" class="doc_header"><code>TypeDispatch.returns</code><a href="__main__.py#L24" class="source_link" style="float:right">[source]</a></h4>
<blockquote>
<div><p><code>TypeDispatch.returns</code>(<strong><code class="docutils literal notranslate"><span class="pre">x</span></code></strong>)</p>
</div></blockquote>
<p>Get the return type of annotation of <code class="docutils literal notranslate"><span class="pre">x</span></code>.</p>
</div>
</div>
<p>You can optionally pass an object to <code class="docutils literal notranslate"><span class="pre">TypeDispatch.returns</span></code> and get the return type annotation back:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f1</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span> <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">f2</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="k">return</span> <span class="n">List</span>
<span class="k">def</span> <span class="nf">f3</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="nb">float</span><span class="p">):</span> <span class="k">return</span> <span class="n">List</span> <span class="c1"># f3 has no return type annotation</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">TypeDispatch</span><span class="p">([</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">f3</span><span class="p">])</span>

<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">returns</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>  <span class="c1"># dispatched to f1</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">returns</span><span class="p">(</span><span class="s1">&#39;Hello&#39;</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span> <span class="c1"># dispatched to f2</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">returns</span><span class="p">(</span><span class="mf">1.0</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>      <span class="c1"># dispatched to f3</span>

<span class="k">class</span> <span class="nc">_Test</span><span class="p">:</span> <span class="k">pass</span>
<span class="n">_test</span> <span class="o">=</span> <span class="n">_Test</span><span class="p">()</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">returns</span><span class="p">(</span><span class="n">_test</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span> <span class="c1"># type `_Test` not found, so None returned</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="using-typedispatch-with-methods">
<h3>Using TypeDispatch With Methods<a class="headerlink" href="#using-typedispatch-with-methods" title="Permalink to this headline">¶</a></h3>
<p>You can use <code class="docutils literal notranslate"><span class="pre">TypeDispatch</span></code> when defining methods as well:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">m_nin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:(</span><span class="nb">str</span><span class="p">,</span><span class="n">numbers</span><span class="o">.</span><span class="n">Integral</span><span class="p">)):</span> <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;1&#39;</span>
<span class="k">def</span> <span class="nf">m_bll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span><span class="nb">bool</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">foo</span><span class="o">=</span><span class="s1">&#39;a&#39;</span>
<span class="k">def</span> <span class="nf">m_num</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span><span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">TypeDispatch</span><span class="p">([</span><span class="n">m_nin</span><span class="p">,</span><span class="n">m_num</span><span class="p">,</span><span class="n">m_bll</span><span class="p">])</span>
<span class="k">class</span> <span class="nc">A</span><span class="p">:</span> <span class="n">f</span> <span class="o">=</span> <span class="n">t</span> <span class="c1"># set class attribute `f` equal to a TypeDispatch instance</span>
    
<span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;11&#39;</span><span class="p">)</span>  <span class="c1">#dispatch to m_nin</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="mf">1.</span><span class="p">),</span> <span class="mf">2.</span><span class="p">)</span>   <span class="c1">#dispatch to m_num</span>
<span class="n">test_is</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">inst</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

<span class="n">a</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># this triggers t.m_bll to run, which sets self.foo to &#39;a&#39;</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">foo</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>As discussed in <code class="docutils literal notranslate"><span class="pre">TypeDispatch.__call__</span></code>, when there is not a match, <code class="docutils literal notranslate"><span class="pre">TypeDispatch.__call__</span></code> becomes an identity function.  In the below example, a tuple does not match any type annotations so a tuple is returned:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">f</span><span class="p">(()),</span> <span class="p">())</span> 
</pre></div>
</div>
</div>
</div>
<p>We extend the previous example by using <code class="docutils literal notranslate"><span class="pre">bases</span></code> to add an additional method that supports tuples:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">m_tup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span><span class="nb">tuple</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
<span class="n">t2</span> <span class="o">=</span> <span class="n">TypeDispatch</span><span class="p">(</span><span class="n">m_tup</span><span class="p">,</span> <span class="n">bases</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">A2</span><span class="p">:</span> <span class="n">f</span> <span class="o">=</span> <span class="n">t2</span>
<span class="n">a2</span> <span class="o">=</span> <span class="n">A2</span><span class="p">()</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">a2</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;11&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">a2</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="mf">1.</span><span class="p">),</span> <span class="mf">2.</span><span class="p">)</span>
<span class="n">test_is</span><span class="p">(</span><span class="n">a2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">inst</span><span class="p">,</span> <span class="n">a2</span><span class="p">)</span>
<span class="n">a2</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">a2</span><span class="o">.</span><span class="n">foo</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">a2</span><span class="o">.</span><span class="n">f</span><span class="p">(()),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="using-typedispatch-with-class-methods">
<h3>Using TypeDispatch With Class Methods<a class="headerlink" href="#using-typedispatch-with-class-methods" title="Permalink to this headline">¶</a></h3>
<p>You can use <code class="docutils literal notranslate"><span class="pre">TypeDispatch</span></code> when defining class methods too:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">m_nin</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">x</span><span class="p">:(</span><span class="nb">str</span><span class="p">,</span><span class="n">numbers</span><span class="o">.</span><span class="n">Integral</span><span class="p">)):</span> <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;1&#39;</span>
<span class="k">def</span> <span class="nf">m_bll</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span><span class="nb">bool</span><span class="p">):</span> <span class="bp">cls</span><span class="o">.</span><span class="n">foo</span><span class="o">=</span><span class="s1">&#39;a&#39;</span>
<span class="k">def</span> <span class="nf">m_num</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span><span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">TypeDispatch</span><span class="p">([</span><span class="n">m_nin</span><span class="p">,</span><span class="n">m_num</span><span class="p">,</span><span class="n">m_bll</span><span class="p">])</span>
<span class="k">class</span> <span class="nc">A</span><span class="p">:</span> <span class="n">f</span> <span class="o">=</span> <span class="n">t</span> <span class="c1"># set class attribute `f` equal to a TypeDispatch</span>

<span class="n">test_eq</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;11&#39;</span><span class="p">)</span>  <span class="c1">#dispatch to m_nin</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="mf">1.</span><span class="p">),</span> <span class="mf">2.</span><span class="p">)</span>   <span class="c1">#dispatch to m_num</span>
<span class="n">test_is</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">owner</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>

<span class="n">A</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># this triggers t.m_bll to run, which sets A.foo to &#39;a&#39;</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">foo</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="typedispatch-decorator">
<h2>typedispatch Decorator<a class="headerlink" href="#typedispatch-decorator" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">class</span> <span class="nc">DispatchReg</span><span class="p">:</span>
    <span class="s2">&quot;A global registry for `TypeDispatch` objects keyed by function name&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">TypeDispatch</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="nb">classmethod</span><span class="p">,</span> <span class="nb">staticmethod</span><span class="p">)):</span> <span class="n">nm</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="vm">__func__</span><span class="o">.</span><span class="vm">__qualname__</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">nm</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="vm">__qualname__</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">classmethod</span><span class="p">):</span> <span class="n">f</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="vm">__func__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">nm</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">nm</span><span class="p">]</span>

<span class="n">typedispatch</span> <span class="o">=</span> <span class="n">DispatchReg</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@typedispatch</span>
<span class="k">def</span> <span class="nf">f_td_test</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span> <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">}{</span><span class="n">y</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="nd">@typedispatch</span>
<span class="k">def</span> <span class="nf">f_td_test</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="n">numbers</span><span class="o">.</span><span class="n">Integral</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span>
<span class="nd">@typedispatch</span>
<span class="k">def</span> <span class="nf">f_td_test</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="nb">float</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span>
<span class="nd">@typedispatch</span>
<span class="k">def</span> <span class="nf">f_td_test</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="nb">int</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span>

<span class="n">test_eq</span><span class="p">(</span><span class="n">f_td_test</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mf">2.0</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">issubclass</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Integral</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">f_td_test</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">6</span><span class="p">)</span>

<span class="n">test_eq</span><span class="p">(</span><span class="n">f_td_test</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">),</span> <span class="s1">&#39;ab&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="using-typedispatch-with-other-decorators">
<h3>Using typedispatch With other decorators<a class="headerlink" href="#using-typedispatch-with-other-decorators" title="Permalink to this headline">¶</a></h3>
<p>You can use <code class="docutils literal notranslate"><span class="pre">typedispatch</span></code> with <code class="docutils literal notranslate"><span class="pre">classmethod</span></code> and <code class="docutils literal notranslate"><span class="pre">staticmethod</span></code> decorator</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="nd">@typedispatch</span>
    <span class="k">def</span> <span class="nf">f_td_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span><span class="n">numbers</span><span class="o">.</span><span class="n">Integral</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span>
    <span class="nd">@typedispatch</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">f_td_test</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="nb">float</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span>
    <span class="nd">@typedispatch</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">f_td_test</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="nb">int</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span>
    
<span class="n">test_eq</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">f_td_test</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">f_td_test</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mf">2.0</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">A</span><span class="p">()</span><span class="o">.</span><span class="n">f_td_test</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;2.0&#39;</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="casting">
<h2>Casting<a class="headerlink" href="#casting" title="Permalink to this headline">¶</a></h2>
<p>Now that we can dispatch on types, let’s make it easier to cast objects to a different type.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="n">_all_</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cast&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">retain_meta</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">as_copy</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="s2">&quot;Call `res.set_meta(x)`, if it exists&quot;</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="s1">&#39;set_meta&#39;</span><span class="p">):</span> <span class="n">res</span><span class="o">.</span><span class="n">set_meta</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">as_copy</span><span class="o">=</span><span class="n">as_copy</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">default_set_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">as_copy</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="s2">&quot;Copy over `_meta` from `x` to `res`, if it&#39;s missing&quot;</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;_meta&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_meta&#39;</span><span class="p">):</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">_meta</span>
        <span class="k">if</span> <span class="n">as_copy</span><span class="p">:</span> <span class="n">meta</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">meta</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span> <span class="o">=</span> <span class="n">meta</span>
    <span class="k">return</span> <span class="bp">self</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="nd">@typedispatch</span>
<span class="k">def</span> <span class="nf">cast</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">typ</span><span class="p">):</span>
    <span class="s2">&quot;cast `x` to type `typ` (may also change `x` inplace)&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">typ</span><span class="o">.</span><span class="n">_before_cast</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="s1">&#39;_before_cast&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span>
    <span class="k">if</span> <span class="n">risinstance</span><span class="p">(</span><span class="s1">&#39;ndarray&#39;</span><span class="p">,</span> <span class="n">res</span><span class="p">):</span> <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">typ</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="s1">&#39;as_subclass&#39;</span><span class="p">):</span> <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">as_subclass</span><span class="p">(</span><span class="n">typ</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span> <span class="n">res</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">=</span> <span class="n">typ</span>
        <span class="k">except</span><span class="p">:</span> <span class="n">res</span> <span class="o">=</span> <span class="n">typ</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">retain_meta</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This works both for plain python classes:…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mk_class</span><span class="p">(</span><span class="s1">&#39;_T1&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>   <span class="c1"># mk_class is a fastai utility that constructs a class.</span>
<span class="k">class</span> <span class="nc">_T2</span><span class="p">(</span><span class="n">_T1</span><span class="p">):</span> <span class="k">pass</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">_T1</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">t2</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">_T2</span><span class="p">)</span>        
<span class="k">assert</span> <span class="n">t2</span> <span class="ow">is</span> <span class="n">t</span>            <span class="c1"># t2 refers to the same object as t</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">_T2</span><span class="p">)</span> <span class="c1"># t also changed in-place</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span> <span class="n">_T2</span><span class="p">)</span>

<span class="n">test_eq_type</span><span class="p">(</span><span class="n">_T2</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">t2</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
<p>…as well as for arrays and tensors.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">_T1</span><span class="p">(</span><span class="n">ndarray</span><span class="p">):</span> <span class="k">pass</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
<span class="n">t2</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">_T1</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">]),</span> <span class="n">t2</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">_T1</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">t2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>To customize casting for other types, define a separate <code class="docutils literal notranslate"><span class="pre">cast</span></code> function with <code class="docutils literal notranslate"><span class="pre">typedispatch</span></code> for your type.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">retain_type</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">old</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">as_copy</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="s2">&quot;Cast `new` to type of `old` or `typ` if it&#39;s a superclass&quot;</span>
    <span class="c1"># e.g. old is TensorImage, new is Tensor - if not subclass then do nothing</span>
    <span class="k">if</span> <span class="n">new</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span>
    <span class="k">assert</span> <span class="n">old</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">typ</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">new</span><span class="p">)):</span> <span class="k">return</span> <span class="n">new</span>
        <span class="n">typ</span> <span class="o">=</span> <span class="n">old</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">old</span><span class="p">,</span><span class="nb">type</span><span class="p">)</span> <span class="k">else</span> <span class="nb">type</span><span class="p">(</span><span class="n">old</span><span class="p">)</span>
    <span class="c1"># Do nothing the new type is already an instance of requested type (i.e. same type)</span>
    <span class="k">if</span> <span class="n">typ</span><span class="o">==</span><span class="n">NoneType</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">typ</span><span class="p">):</span> <span class="k">return</span> <span class="n">new</span>
    <span class="k">return</span> <span class="n">retain_meta</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">cast</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">typ</span><span class="p">),</span> <span class="n">as_copy</span><span class="o">=</span><span class="n">as_copy</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">_T</span><span class="p">(</span><span class="nb">tuple</span><span class="p">):</span> <span class="k">pass</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">_T</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">b</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">retain_type</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="n">_T</span><span class="p">)</span>
<span class="n">test_eq_type</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">old</span></code> has a <code class="docutils literal notranslate"><span class="pre">_meta</span></code> attribute, its content is passed when casting <code class="docutils literal notranslate"><span class="pre">new</span></code> to the type of <code class="docutils literal notranslate"><span class="pre">old</span></code>.  In the below example, only the attribute <code class="docutils literal notranslate"><span class="pre">a</span></code>, but not <code class="docutils literal notranslate"><span class="pre">other_attr</span></code> is kept, because <code class="docutils literal notranslate"><span class="pre">other_attr</span></code> is not in <code class="docutils literal notranslate"><span class="pre">_meta</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">_A</span><span class="p">():</span>
    <span class="n">set_meta</span> <span class="o">=</span> <span class="n">default_set_meta</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">=</span><span class="n">t</span>

<span class="k">class</span> <span class="nc">_B1</span><span class="p">(</span><span class="n">_A</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="n">a</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">other_attr</span> <span class="o">=</span> <span class="s1">&#39;Hello&#39;</span> <span class="c1"># will not be kept after casting.</span>
        
<span class="n">x</span> <span class="o">=</span> <span class="n">_B1</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">_A</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">retain_type</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">old</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">_meta</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s1">&#39;other_attr&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">retain_types</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">old</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">typs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="s2">&quot;Cast each item of `new` to type of matching item in `old` if it&#39;s a superclass&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_listy</span><span class="p">(</span><span class="n">new</span><span class="p">):</span> <span class="k">return</span> <span class="n">retain_type</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">typs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">typs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">first</span><span class="p">(</span><span class="n">typs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">typs</span> <span class="o">=</span> <span class="n">typs</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">t</span><span class="p">,</span><span class="n">typs</span> <span class="o">=</span> <span class="n">typs</span><span class="p">,</span><span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">t</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">old</span><span class="p">)</span> <span class="k">if</span> <span class="n">old</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">old</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">new</span><span class="p">))</span> <span class="k">else</span> <span class="nb">type</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">t</span><span class="p">(</span><span class="n">L</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">typs</span><span class="p">)</span><span class="o">.</span><span class="n">map_zip</span><span class="p">(</span><span class="n">retain_types</span><span class="p">,</span> <span class="n">cycled</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">T</span><span class="p">(</span><span class="nb">tuple</span><span class="p">):</span> <span class="k">pass</span>

<span class="n">t1</span><span class="p">,</span><span class="n">t2</span> <span class="o">=</span> <span class="n">retain_types</span><span class="p">((</span><span class="mi">1</span><span class="p">,(</span><span class="mi">1</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">T</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="n">T</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">))))))</span>
<span class="n">test_eq_type</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">test_eq_type</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span> <span class="n">T</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="n">T</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)))))</span>

<span class="n">t1</span><span class="p">,</span><span class="n">t2</span> <span class="o">=</span> <span class="n">retain_types</span><span class="p">((</span><span class="mi">1</span><span class="p">,(</span><span class="mi">1</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))),</span> <span class="n">typs</span> <span class="o">=</span> <span class="p">{</span><span class="nb">tuple</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span><span class="n">T</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span><span class="n">T</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">]}]}]})</span>
<span class="n">test_eq_type</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">test_eq_type</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span> <span class="n">T</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="n">T</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)))))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">explode_types</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
    <span class="s2">&quot;Return the type of `o`, potentially in nested dictionaries for thing that are listy&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_listy</span><span class="p">(</span><span class="n">o</span><span class="p">):</span> <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">):</span> <span class="p">[</span><span class="n">explode_types</span><span class="p">(</span><span class="n">o_</span><span class="p">)</span> <span class="k">for</span> <span class="n">o_</span> <span class="ow">in</span> <span class="n">o</span><span class="p">]}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">explode_types</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="n">T</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="n">T</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)))))),</span> <span class="p">{</span><span class="nb">tuple</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span><span class="n">T</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span><span class="n">T</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">]}]}]})</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="export">
<h2>Export -<a class="headerlink" href="#export" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#hide</span>
<span class="kn">from</span> <span class="nn">nbdev.export</span> <span class="kn">import</span> <span class="n">notebook2script</span>
<span class="n">notebook2script</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Converted 00_test.ipynb.
Converted 01_basics.ipynb.
Converted 02_foundation.ipynb.
Converted 03_xtras.ipynb.
Converted 03a_parallel.ipynb.
Converted 03b_net.ipynb.
Converted 04_dispatch.ipynb.
Converted 05_transform.ipynb.
Converted 07_meta.ipynb.
Converted 08_script.ipynb.
Converted index.ipynb.
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Hamel Husain<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>